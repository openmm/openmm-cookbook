<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Beta-2-adrenergic receptor (B2AR) membrane protein simulation with CHARMM &#8212; OpenMM Cookbook &amp; Tutorials dev documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=a0d4cc31" />
    <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <link rel="stylesheet" type="text/css" href="../../_static/notebooks.css?v=9b8a9a20" />
    <script src="../../_static/documentation_options.js?v=3ce10a4d"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="HSP90 with ADP:Mg2+ simulation" href="HSP90_with_ADPMg2_simulation.html" />
    <link rel="prev" title="Alchemical free energy calculations" href="Alchemical_free_energy_calculations.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="nbsphinx-prolog">
    <a href="Beta_2_adrenergic_receptor_B2AR_membrane_protein_simulation_with_CHARMM.ipynb">Download Notebook</a>
    <a href="https://github.com/openmm/openmm-cookbook/blob/main/notebooks/tutorials/Beta_2_adrenergic_receptor_B2AR_membrane_protein_simulation_with_CHARMM.ipynb">View in GitHub</a>
    <a href="https://colab.research.google.com/github/openmm/openmm-cookbook/blob/gh-pages/dev/colab/notebooks/tutorials/Beta_2_adrenergic_receptor_B2AR_membrane_protein_simulation_with_CHARMM.ipynb">Open in Google Colab</a>
</div><span class="target" id="index-0"></span><section id="Beta-2-adrenergic-receptor-(B2AR)-membrane-protein-simulation-with-CHARMM">
<h1>Beta-2-adrenergic receptor (B2AR) membrane protein simulation with CHARMM<a class="headerlink" href="#Beta-2-adrenergic-receptor-(B2AR)-membrane-protein-simulation-with-CHARMM" title="Link to this heading">¶</a></h1>
<p><em>Use CHARMM-GUI to set up a membrane protein simulation for OpenMM.</em></p>
<section id="Files">
<h2>Files<a class="headerlink" href="#Files" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>The initial membrane protein PDB file <a class="reference external" href="https://openmm.org/tutorials_/b2ar_membrane/files/apo_snapshot.pdb">apo_snapshot.pdb</a> comes from reference structures provided in Kohloff et.al. 2014, originally from PDB ID: 3POG.</p></li>
<li><p>A tarball of the CHARMM-GUI output can be found in <a class="reference external" href="https://openmm.org/tutorials_/b2ar_membrane/files/charmm-gui.zip">charmm-gui.zip</a></p></li>
</ul>
</section>
<section id="Using-CHARMM-GUI-to-embed-B2AR-in-a-solvated-membrane">
<h2>Using CHARMM-GUI to embed B2AR in a solvated membrane<a class="headerlink" href="#Using-CHARMM-GUI-to-embed-B2AR-in-a-solvated-membrane" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Go to <a class="reference external" href="http://www.charmm-gui.org/?doc=input/membrane">CHARMM-GUI’s membrane builder</a> and upload the pdb file. (<code class="docutils literal notranslate"><span class="pre">apo_snapshot.pdb</span></code>). Select PDB format and click <code class="docutils literal notranslate"><span class="pre">Next</span> <span class="pre">Step</span></code>.</p></li>
<li><p>Stick with the default selection (Protein) and click <code class="docutils literal notranslate"><span class="pre">Next</span> <span class="pre">Step</span></code>.</p></li>
<li><p>Select <code class="docutils literal notranslate"><span class="pre">Terminal</span> <span class="pre">group</span> <span class="pre">patching</span></code> and select termin <code class="docutils literal notranslate"><span class="pre">NTER</span></code> and <code class="docutils literal notranslate"><span class="pre">CTER</span></code>.</p></li>
<li><p>Select <code class="docutils literal notranslate"><span class="pre">Disulfide</span> <span class="pre">bonds</span></code> for the pairs <code class="docutils literal notranslate"><span class="pre">184-190</span></code> and <code class="docutils literal notranslate"><span class="pre">106-191</span></code> and click <code class="docutils literal notranslate"><span class="pre">Next</span> <span class="pre">Step</span></code>.</p></li>
<li><p>Select <code class="docutils literal notranslate"><span class="pre">Align</span> <span class="pre">the</span> <span class="pre">First</span> <span class="pre">Principal</span> <span class="pre">Axis</span> <span class="pre">Along</span> <span class="pre">Z</span></code>(the suggestion for a homo-oligomer) and click <code class="docutils literal notranslate"><span class="pre">Next</span> <span class="pre">Step</span></code>.</p></li>
<li><p>Keep the default selections for <code class="docutils literal notranslate"><span class="pre">Heterogeneous</span> <span class="pre">Lipid</span></code>, <code class="docutils literal notranslate"><span class="pre">Rectangular</span> <span class="pre">Box</span> <span class="pre">Type</span></code>, <code class="docutils literal notranslate"><span class="pre">17.5</span> <span class="pre">water</span> <span class="pre">thickness</span></code>. Select <code class="docutils literal notranslate"><span class="pre">Number</span> <span class="pre">of</span> <span class="pre">lipid</span> <span class="pre">components</span></code> and select <code class="docutils literal notranslate"><span class="pre">POPC</span></code> lipids with <code class="docutils literal notranslate"><span class="pre">55</span></code> lipids on the upperleaflet and lowerleaflet. Click <code class="docutils literal notranslate"><span class="pre">Next</span> <span class="pre">Step</span></code>.</p></li>
<li><p>Keep all default selections (<code class="docutils literal notranslate"><span class="pre">Replacement</span> <span class="pre">method</span></code>, <code class="docutils literal notranslate"><span class="pre">check</span> <span class="pre">lipid</span> <span class="pre">ring</span> <span class="pre">(and</span> <span class="pre">protein</span> <span class="pre">surface)</span> <span class="pre">penetration</span></code>, <code class="docutils literal notranslate"><span class="pre">Include</span> <span class="pre">Ions</span> <span class="pre">0.15</span> <span class="pre">KCl</span></code> and <code class="docutils literal notranslate"><span class="pre">Ion</span> <span class="pre">Placing</span> <span class="pre">Method:</span> <span class="pre">Monte-Carlo</span></code>. Click <code class="docutils literal notranslate"><span class="pre">Next</span> <span class="pre">Step</span></code>.</p></li>
<li><p>Click <code class="docutils literal notranslate"><span class="pre">Next</span> <span class="pre">Step</span></code> to assemble components. When you arrive at <code class="docutils literal notranslate"><span class="pre">Step</span> <span class="pre">5</span></code>, select <code class="docutils literal notranslate"><span class="pre">OpenMM</span></code> as the Input generation option. Keep all the other default options (<code class="docutils literal notranslate"><span class="pre">Generate</span> <span class="pre">grid</span> <span class="pre">information</span> <span class="pre">for</span> <span class="pre">PME</span> <span class="pre">FFT</span> <span class="pre">automatically</span></code> and <code class="docutils literal notranslate"><span class="pre">NPT</span> <span class="pre">ensemble</span></code>. Click <code class="docutils literal notranslate"><span class="pre">Next</span> <span class="pre">Step</span></code>.</p></li>
</ol>
<p><img alt="b2ar_membrane" src="../../_images/b2ar_membrane.jpeg" /></p>
</section>
<section id="Simulating-the-system-in-OpenMM">
<h2>Simulating the system in OpenMM<a class="headerlink" href="#Simulating-the-system-in-OpenMM" title="Link to this heading">¶</a></h2>
<section id="The-quick-way">
<h3>The quick way<a class="headerlink" href="#The-quick-way" title="Link to this heading">¶</a></h3>
<p>From the <code class="docutils literal notranslate"><span class="pre">charmm-gui.tgz</span></code> extract <code class="docutils literal notranslate"><span class="pre">toppar/</span></code> directory and the <code class="docutils literal notranslate"><span class="pre">openmm/</span></code> directory. The <code class="docutils literal notranslate"><span class="pre">README</span></code> file in the <code class="docutils literal notranslate"><span class="pre">openmm/</span></code> directory is a csh script to run a standard equilibration and production simulation.</p>
</section>
</section>
<section id="The-flexible-way">
<h2>The flexible way<a class="headerlink" href="#The-flexible-way" title="Link to this heading">¶</a></h2>
<p>If you want finer control, you can write your own OpenMM code to equilibrate and simulate the system.</p>
<p>OpenMM can directly read CHARMM input files through the use of the <code class="docutils literal notranslate"><span class="pre">openmm.app</span></code> application layer. This enables the use of all the powerful setup tools in the CHARMM ecosystem that a user might be familiar with such as the <a class="reference external" href="http://onlinelibrary.wiley.com/doi/10.1002/jcc.20945/abstract">CHARMM-GUI</a>, <a class="reference external" href="http://www.sciencedirect.com/science/article/pii/0263785596000185?via%3Dihub">VMD</a>, <a class="reference external" href="https://cgenff.paramchem.org/">CGenFF</a> program
(<a class="reference external" href="http://onlinelibrary.wiley.com/doi/10.1002/jcc.21367/abstract">DOI:10.1002/jcc.21367</a>), etc. This allows users who are already working in the CHARMM environment to harness the GPU speeds that OpenMM provides without having to modify their simulation system description files.</p>
<p>OpenMM can also read CHARMM force field files making it is possible to use force fields that aren’t already included in OpenMM such as the general CHARMM force field (CGenFF). For example, a user can generate an <code class="docutils literal notranslate"><span class="pre">str</span></code> file with the <a class="reference external" href="https://cgenff.paramchem.org/">CGenFF program</a> for a ligand and load it into OpenMM. However, when using this feature, the <code class="docutils literal notranslate"><span class="pre">CharmmParameterSet</span></code> class needs to be used instead of the <code class="docutils literal notranslate"><span class="pre">ForceField</span></code> class to load all the other CHARMM force field files as
demonstrated in the example in the code below.</p>
<p>The example demonstrates how to use CHARMMM files that were generated with the CHARMM-GUI in an OpenMM script. The OpenMM app layer includes several classes to load CHARMM files. The <code class="docutils literal notranslate"><span class="pre">CharmmPsfFile</span></code> class reads the <code class="docutils literal notranslate"><span class="pre">psf</span></code> file and instantiates a chemical structure on which one can then call the <code class="docutils literal notranslate"><span class="pre">createSystem()</span></code> method to creates an OpenMM system object. For the atomic coordinates, a regular pdb file can be used or the <code class="docutils literal notranslate"><span class="pre">CharmmCrdFile</span></code> or <code class="docutils literal notranslate"><span class="pre">CharmmRstFile</span></code> classes can be used to read CHARMM
coordinate files. Files containing force field definitions come in a variety of formats such as <code class="docutils literal notranslate"><span class="pre">prm</span></code>, <code class="docutils literal notranslate"><span class="pre">par</span></code>, <code class="docutils literal notranslate"><span class="pre">top</span></code>, <code class="docutils literal notranslate"><span class="pre">rtf</span></code>, <code class="docutils literal notranslate"><span class="pre">inp</span></code> and <code class="docutils literal notranslate"><span class="pre">str</span></code>. These files are loaded into a <code class="docutils literal notranslate"><span class="pre">CharmmParameterSet</span></code> object which is then included as the first parameter when <code class="docutils literal notranslate"><span class="pre">createSystem()</span></code> is called on the chemical structure. For this example, the <a class="reference external" href="http://dx.doi.org/10.1371/journal.pone.0000880">membrane builder</a> in the CHARMM-GUI was used to generate the input files for the B2AR in a POPC lipid
membrane. The membrane builder provides a straightforward way to go from the RCSB X-ray structure to the protein embedded in a membrane with all the relevant CHARMM input files.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># download and extract the files</span>
<span class="o">!</span>wget<span class="w"> </span>https://openmm.org/tutorials_/b2ar_membrane/files/charmm-gui.zip
<span class="o">!</span>tar<span class="w"> </span>xvf<span class="w"> </span>charmm-gui.zip
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><br/><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">openmm.app</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openmm</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openmm.unit</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sys</span><span class="w"> </span><span class="kn">import</span> <span class="n">stdout</span>

<span class="c1"># Load CHARMM files</span>
<span class="n">psf</span> <span class="o">=</span> <span class="n">CharmmPsfFile</span><span class="p">(</span><span class="s1">&#39;charmm-gui/openmm/step5_charmm2omm.psf&#39;</span><span class="p">)</span>
<span class="n">pdb</span> <span class="o">=</span> <span class="n">PDBFile</span><span class="p">(</span><span class="s1">&#39;charmm-gui/openmm/step5_charmm2omm.pdb&#39;</span><span class="p">)</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">CharmmParameterSet</span><span class="p">(</span><span class="s1">&#39;charmm-gui/toppar/par_all36_prot.prm&#39;</span><span class="p">,</span> <span class="s1">&#39;charmm-gui/toppar/top_all36_prot.rtf&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;charmm-gui/toppar/par_all36_lipid.prm&#39;</span><span class="p">,</span> <span class="s1">&#39;charmm-gui/toppar/top_all36_lipid.rtf&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;charmm-gui/toppar/toppar_water_ions.str&#39;</span><span class="p">)</span>

<span class="c1"># Create an openmm system by calling createSystem on psf</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">psf</span><span class="o">.</span><span class="n">createSystem</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nonbondedMethod</span><span class="o">=</span><span class="n">CutoffNonPeriodic</span><span class="p">,</span>
         <span class="n">nonbondedCutoff</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">nanometer</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="n">HBonds</span><span class="p">)</span>
<span class="n">integrator</span> <span class="o">=</span> <span class="n">LangevinIntegrator</span><span class="p">(</span><span class="mi">300</span><span class="o">*</span><span class="n">kelvin</span><span class="p">,</span>   <span class="c1"># Temperature of head bath</span>
                                <span class="mi">1</span><span class="o">/</span><span class="n">picosecond</span><span class="p">,</span> <span class="c1"># Friction coefficient</span>
                                <span class="mf">0.002</span><span class="o">*</span><span class="n">picoseconds</span><span class="p">)</span> <span class="c1"># Time step</span>


<span class="n">simulation</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">topology</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">integrator</span><span class="p">)</span>
<span class="n">simulation</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">setPositions</span><span class="p">(</span><span class="n">pdb</span><span class="o">.</span><span class="n">positions</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Minimizing...&quot;</span><span class="p">)</span>
<span class="n">simulation</span><span class="o">.</span><span class="n">minimizeEnergy</span><span class="p">()</span>

<span class="c1"># Set up the reporters to report energies every 1000 steps.</span>
<span class="n">simulation</span><span class="o">.</span><span class="n">reporters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PDBReporter</span><span class="p">(</span><span class="s1">&#39;output.pdb&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
<span class="n">simulation</span><span class="o">.</span><span class="n">reporters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">StateDataReporter</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">potentialEnergy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="c1"># run simulation</span>
<span class="n">simulation</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="Alchemical_free_energy_calculations.html" title="Previous document">Alchemical free energy calculations</a>
        </li>
        <li>
          <a href="HSP90_with_ADPMg2_simulation.html" title="Next document">HSP90 with ADP:Mg2+ simulation</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../index.html">
    <img class="logo" src="../../_static/logo.svg" alt="Logo" />
    
    <h1 class="logo logo-name">OpenMM Cookbook & Tutorials</h1>
    
  </a>
</p>











<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><div class="navigation-scrollbox">
    <div class="nav-toctree">
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../cookbook.html">The OpenMM Cookbook</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../tutorials.html">The OpenMM Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../tutorials.html#getting-started">Getting Started</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../tutorials.html#beyond-the-basics">Beyond the Basics</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="coarse_grained_polymer.html">Coarse-Grained Polymer</a></li>
<li class="toctree-l3"><a class="reference internal" href="Alchemical_free_energy_calculations.html">Alchemical free energy calculations</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Beta-2-adrenergic receptor (B2AR) membrane protein simulation with CHARMM</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Files">Files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Using-CHARMM-GUI-to-embed-B2AR-in-a-solvated-membrane">Using CHARMM-GUI to embed B2AR in a solvated membrane</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Simulating-the-system-in-OpenMM">Simulating the system in OpenMM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#The-flexible-way">The flexible way</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="HSP90_with_ADPMg2_simulation.html">HSP90 with ADP:Mg2+ simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="Histone_methyltransferase_simulation_with_a_multisite_water_model_TIP4P-Ew.html">Histone methyltransferase simulation with a multisite water model (TIP4P-Ew)</a></li>
<li class="toctree-l3"><a class="reference internal" href="Histone_methyltransferase_simulation_with_multisite_Zn2_structural_ions.html">Histone methyltransferase simulation with multisite Zn2+ structural ions</a></li>
<li class="toctree-l3"><a class="reference internal" href="Running_a_REST_simulation.html">Run a REST simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="umbrella_sampling.html">Umbrella Sampling</a></li>
</ul>
</li>
</ul>
</li>
</ul>

    </div>
    
    <ul class="extra-nav-links">
        
        <li class="toctree-l1">
            <a href="https://openmm.org">
                OpenMM.org
            </a>
        </li>
        
        <li class="toctree-l1">
            <a href="https://docs.openmm.org/latest/userguide/">
                User's Manual
            </a>
        </li>
        
        <li class="toctree-l1">
            <a href="https://docs.openmm.org/latest/developerguide/">
                Developer Guide
            </a>
        </li>
        
        <li class="toctree-l1">
            <a href="https://docs.openmm.org/latest/api-c++/">
                C++ API reference
            </a>
        </li>
        
        <li class="toctree-l1">
            <a href="https://docs.openmm.org/latest/api-python/">
                Python API reference
            </a>
        </li>
        
        <li class="toctree-l1">
            <a href="https://github.com/openmm/openmm">
                GitHub
            </a>
        </li>
        
    </ul>
    
</div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, The OpenMM Contributors.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../../_sources/notebooks/tutorials/Beta_2_adrenergic_receptor_B2AR_membrane_protein_simulation_with_CHARMM.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>